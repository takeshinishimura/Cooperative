<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.302">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>データの整形</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="08_data_formatting_files/libs/clipboard/clipboard.min.js"></script>
<script src="08_data_formatting_files/libs/quarto-html/quarto.js"></script>
<script src="08_data_formatting_files/libs/quarto-html/popper.min.js"></script>
<script src="08_data_formatting_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="08_data_formatting_files/libs/quarto-html/anchor.min.js"></script>
<link href="08_data_formatting_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="08_data_formatting_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="08_data_formatting_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="08_data_formatting_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="08_data_formatting_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="08_data_formatting_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="08_data_formatting_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="08_data_formatting_files/libs/datatables-binding-0.27/datatables.js"></script>
<script src="08_data_formatting_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="08_data_formatting_files/libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="08_data_formatting_files/libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="08_data_formatting_files/libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<script src="08_data_formatting_files/libs/jszip-1.12.1/jszip.min.js"></script>
<link href="08_data_formatting_files/libs/dt-ext-buttons-1.12.1/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="08_data_formatting_files/libs/dt-ext-buttons-1.12.1/js/dataTables.buttons.min.js"></script>
<script src="08_data_formatting_files/libs/dt-ext-buttons-1.12.1/js/buttons.html5.min.js"></script>
<script src="08_data_formatting_files/libs/dt-ext-buttons-1.12.1/js/buttons.colVis.min.js"></script>
<script src="08_data_formatting_files/libs/dt-ext-buttons-1.12.1/js/buttons.print.min.js"></script>
<link href="08_data_formatting_files/libs/dt-ext-colreorder-1.12.1/css/colReorder.dataTables.min.css" rel="stylesheet">
<script src="08_data_formatting_files/libs/dt-ext-colreorder-1.12.1/js/dataTables.colReorder.min.js"></script>
<link href="08_data_formatting_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="08_data_formatting_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#e-statからデータ取得" id="toc-e-statからデータ取得" class="nav-link active" data-scroll-target="#e-statからデータ取得"><span class="header-section-number">1</span> e-Statからデータ取得</a></li>
  <li><a href="#データ整形" id="toc-データ整形" class="nav-link" data-scroll-target="#データ整形"><span class="header-section-number">2</span> データ整形</a></li>
  <li><a href="#データ整形-1" id="toc-データ整形-1" class="nav-link" data-scroll-target="#データ整形-1"><span class="header-section-number">3</span> データ整形</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">データの整形</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>ここでは，農業協同組合の組合員数の推移を把握することを試みる。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
農業協同組合及び同連合会一斉調査 確報 総合農協統計表
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><a href="https://www.e-stat.go.jp/dbview?sid=0003406360" target="_blank">https://www.e-stat.go.jp/dbview?sid=0003406360</a></p>
</div>
</div>
</div>
<p>これまで，e-Statから取得したデータをグラフにするまで，何の迷いもなくRのコードを書いているかのように，説明してきた。 しかし実際には，図をどう描くか考える前に，データがどのような構造になっているのかを調べ，試行錯誤している。 ここでは，統計データを取得した後，そのデータの構造を確認しながら，データを整形していく方法を紹介する。</p>
<section id="e-statからデータ取得" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="e-statからデータ取得"><span class="header-section-number">1</span> e-Statからデータ取得</h2>
<p><a href="https://takeshinishimura.github.io/Cooperative/02_stats_estatapi.html" target="_blank">統計データを用いた作図：e-Stat（API）編</a>の後半では，e-StatのAPIを使って，Rに統計データを取り込んだ。 ここでも同様の手法でデータを取得する。</p>
<p>早速，次のコードを実行し，欲しいデータが取得しよう。 なお，statsDataId = “0003406360”の数字はアクセスしたい統計データのIDである。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"https://api.e-stat.go.jp/rest/2.1/app/getSimpleStatsData"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">query =</span> <span class="fu">list</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">appId =</span> keyring<span class="sc">::</span><span class="fu">key_get</span>(<span class="st">"e-stat"</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">statsDataId =</span> <span class="st">"0003406360"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sectionHeaderFlg =</span> <span class="dv">2</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(response)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">text =</span> <span class="fu">sub</span>(<span class="st">"^.*</span><span class="sc">\\\"</span><span class="st">VALUE</span><span class="sc">\\\"\n</span><span class="st">"</span>, <span class="st">""</span>, response), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このデータはどういう構造になっているのか想像できない。 そこで，データの構造を詳細に確認してみる。</p>
</section>
<section id="データ整形" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="データ整形"><span class="header-section-number">2</span> データ整形</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cat01_code 組合員別内訳 area_code 都道府県  time_code 時間軸（年度次） unit
1        110      合計_計         0     全国 2016100000         2016年度   人
2        110      合計_計         0     全国 2015100000         2015年度   人
3        110      合計_計         0     全国 2014100000         2014年度   人
4        110      合計_計         0     全国 2013100000         2013年度   人
5        110      合計_計         0     全国 2012100000         2012年度   人
6        110      合計_計         0     全国 2011100000         2011年度   人
     value
1 10444426
2 10370172
3 10267614
4 10145363
5  9977967
6  9834031</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(df)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      cat01_code                 組合員別内訳 area_code 都道府県  time_code
14004        380 一戸複数正組合員制実施組合数     47000   沖縄県 2008100000
14005        380 一戸複数正組合員制実施組合数     47000   沖縄県 2007100000
14006        380 一戸複数正組合員制実施組合数     47000   沖縄県 2006100000
14007        380 一戸複数正組合員制実施組合数     47000   沖縄県 2005100000
14008        380 一戸複数正組合員制実施組合数     47000   沖縄県 2004100000
14009        380 一戸複数正組合員制実施組合数     47000   沖縄県 2003100000
      時間軸（年度次） unit value
14004         2008年度 組合     1
14005         2007年度 組合     1
14006         2006年度 組合     1
14007         2005年度 組合     1
14008         2004年度 組合     1
14009         2003年度 組合     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14009     8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   14009 obs. of  8 variables:
 $ cat01_code      : int  110 110 110 110 110 110 110 110 110 110 ...
 $ 組合員別内訳    : chr  "合計_計" "合計_計" "合計_計" "合計_計" ...
 $ area_code       : int  0 0 0 0 0 0 0 0 0 0 ...
 $ 都道府県        : chr  "全国" "全国" "全国" "全国" ...
 $ time_code       : int  2016100000 2015100000 2014100000 2013100000 2012100000 2011100000 2010100000 2009100000 2008100000 2007100000 ...
 $ 時間軸（年度次）: chr  "2016年度" "2015年度" "2014年度" "2013年度" ...
 $ unit            : chr  "人" "人" "人" "人" ...
 $ value           : chr  "10444426" "10370172" "10267614" "10145363" ...</code></pre>
</div>
</div>
<p>「都道府県」の列に「全国」があるのが確認できる。 ここでは，都道府県別には検討しないため，“全国”の行だけ抽出すればよいことが分かる。 おそらく，「area_code」が”0”である行は，“全国”に対応していると想像できる。</p>
<p>次に，「時間軸（年度次）」列がそのまま年度が入力されていることが分かる。 そして，“2016年度”，“2015年度”，“2014年度”となっていることから，“年度”を削除して，数値型に変換する必要があることまで見通せる。 「time_code」列は，“2016100000”，“2015100000”，“2014100000”という値が入っており，整数型である。 これが，「時間軸（年度次）」列と同じ情報かどうかは，これだけでは分からない。 “2016”に続く”100000”は何を意味するのだろうか。</p>
<p>「unit」列は単位であり作図には使わないが，数値の意味を確認する際に参照することを覚えておく。 「value」は数値である。 ただし，型が文字列であることから，気をつけなければならないことがありそうである。 NAに “-” が入力されているかもしれない。 この表はロングであるため，「value」の型を変更すれば，ggplot2に使えるかもしれない。</p>
<p>これまでの疑問にひとつずつ答えていこう。 それぞれの列にどういう値が入っているか確認するには，文字列型の場合，table()またはunique()を使えばよい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df[, <span class="st">"都道府県"</span>])</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    1組合当たり          愛知県          愛媛県          茨城県          岡山県 
            249             249             249             249             249 
         沖縄県       関東_小計          岩手県          岐阜県          宮崎県 
            249             249             249             249             249 
         宮城県          京都府       近畿_小計       九州_小計          熊本県 
            249             249             249             249             249 
         群馬県          広島県          香川県          高知県          佐賀県 
            249             249             249             249             249 
         埼玉県          三重県          山形県          山口県          山梨県 
            249             249             249             249             249 
         滋賀県        鹿児島県          秋田県          新潟県        神奈川県 
            249             249             249             249             249 
         青森県          静岡県          石川県          千葉県            全国 
            249             249             249             249             314 
         大阪府          大分県 中国・四国_小計          長崎県          長野県 
            249             249             249             249             249 
         鳥取県          島根県       東海_小計          東京都       東北_小計 
            249             249             249             249             249 
         徳島県          栃木県          奈良県          富山県          福井県 
            249             249             249             249             249 
         福岡県          福島県          兵庫県          北海道       北陸_小計 
            249             249             249             249             249 
       和歌山県 
            249 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df[, <span class="st">"都道府県"</span>])</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "全国"            "1組合当たり"     "北海道"          "東北_小計"      
 [5] "青森県"          "岩手県"          "宮城県"          "秋田県"         
 [9] "山形県"          "福島県"          "関東_小計"       "茨城県"         
[13] "栃木県"          "群馬県"          "埼玉県"          "千葉県"         
[17] "東京都"          "神奈川県"        "山梨県"          "長野県"         
[21] "静岡県"          "北陸_小計"       "新潟県"          "富山県"         
[25] "石川県"          "福井県"          "東海_小計"       "岐阜県"         
[29] "愛知県"          "三重県"          "近畿_小計"       "滋賀県"         
[33] "京都府"          "大阪府"          "兵庫県"          "奈良県"         
[37] "和歌山県"        "中国・四国_小計" "鳥取県"          "島根県"         
[41] "岡山県"          "広島県"          "山口県"          "徳島県"         
[45] "香川県"          "愛媛県"          "高知県"          "九州_小計"      
[49] "福岡県"          "佐賀県"          "長崎県"          "熊本県"         
[53] "大分県"          "宮崎県"          "鹿児島県"        "沖縄県"         </code></pre>
</div>
</div>
<p>table()とunique()は似た結果が出力される。 table()からはそれぞれのレコード数が分かり，unique()からは表にある順番が分かる。 “全国”だけで314もある。 年度の違い以外にも何かありそうなため，全国だけ抽出したとしても，どういうデータ構造になっているのか把握するのは容易ではなさそうである。 「area_code」は確認してもよいが，仮に”0”が”全国”と1対1で対応していなかった場合，「area_code」の特定が難しくなるため，今回は調べないことにする。</p>
<p>なお，ここでデータフレームの列の指定方法について，簡単に説明しておく。 最も簡単かつ短い書き方は次のとおりである。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>都道府県</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これでもよいが，日本語の列名をそのまま使うのは不安である。 例えば，次のようにするとエラーが出る。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>時間軸（年度次）</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>なぜか。 Rを使い慣れている人だとこの理由が分かるはずである。 Rを使っていると，データフレームがこの列名を変えたがることに気づく。 こうしたエラーの回避策はある。 次のようにするとエラーが出ず，欲しい結果が得られる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span><span class="st">'時間軸（年度次）'</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ただし，こういった書き方をするくらいであれば，このページで書いている方法に統一する方がスマートではないだろうか。 短く書きたいときのみ，$で指定すればよい。</p>
<p>話を戻す。 次に，“time_code”列を確認する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df[, <span class="st">"time_code"</span>])</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
1998100000 1999100000 2000100000 2001100000 2002100000 2003100000 2004100000 
        13         13         13         13         13        728        728 
2005100000 2006100000 2007100000 2008100000 2009100000 2010100000 2011100000 
       728        728       1176       1176       1176       1176       1008 
2012100000 2013100000 2014100000 2015100000 2016100000 
      1064       1064       1064       1064       1064 </code></pre>
</div>
</div>
<p>「time_code」列の”100000”は，ここでは意味がなく，sub()で削除できることが分かる。 それでは，「時間軸（年度次）」と1対1で対応しているだろうか。 これを確認する方法はいくらでもある。 例えば，次のようにする。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">apply</span>(df[, <span class="fu">c</span>(<span class="st">"time_code"</span>, <span class="st">"時間軸（年度次）"</span>)], <span class="dv">1</span>, paste, <span class="at">collapse =</span> <span class="st">" "</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
1998100000 1998年度 1999100000 1999年度 2000100000 2000年度 2001100000 2001年度 
                 13                  13                  13                  13 
2002100000 2002年度 2003100000 2003年度 2004100000 2004年度 2005100000 2005年度 
                 13                 728                 728                 728 
2006100000 2006年度 2007100000 2007年度 2008100000 2008年度 2009100000 2009年度 
                728                1176                1176                1176 
2010100000 2010年度 2011100000 2011年度 2012100000 2012年度 2013100000 2013年度 
               1176                1008                1064                1064 
2014100000 2014年度 2015100000 2015年度 2016100000 2016年度 
               1064                1064                1064 </code></pre>
</div>
</div>
<p>ただし，結果をいちいち確認しなければならないため，TRUEで返ってくるかどうかで判断した方がよいかもしれない。 例えば，次のようにすればよい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(df)), <span class="cf">function</span>(i) (df[i, <span class="st">"time_code"</span>] <span class="sc">/</span> <span class="dv">1000000</span> <span class="sc">-</span> <span class="fl">0.1</span>) <span class="sc">==</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">"年度"</span>, <span class="st">""</span>, df[i, <span class="st">"時間軸（年度次）"</span>])))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(x)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x
 TRUE 
14009 </code></pre>
</div>
</div>
<p>年度の入力ミスはなさそうなので，「時間軸（年度次）」列をいじれば，年度の数値が得られることが分かる。</p>
<p>大幅に変更する前に，新しいデータフレームを作成しておく。 以降は新しいデータフレームで作業し，もし間違った場合は，ここに戻ってくれば読み直さずにすむ。 ここで，全国のみのデータを抽出する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df2[df2[, <span class="st">"都道府県"</span>] <span class="sc">==</span> <span class="st">"全国"</span>, ]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>年度 <span class="ot">&lt;-</span> <span class="fu">as.double</span>(<span class="fu">sub</span>(<span class="st">"年度"</span>, <span class="st">""</span>, df2[, <span class="st">"時間軸（年度次）"</span>]))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 必要な列のみ抽出する</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> df2[, <span class="fu">c</span>(<span class="st">"組合員別内訳"</span>, <span class="st">"都道府県"</span>, <span class="st">"年度"</span>, <span class="st">"unit"</span>, <span class="st">"value"</span>)]</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df3)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  組合員別内訳 都道府県 年度 unit    value
1      合計_計     全国 2016   人 10444426
2      合計_計     全国 2015   人 10370172
3      合計_計     全国 2014   人 10267614
4      合計_計     全国 2013   人 10145363
5      合計_計     全国 2012   人  9977967
6      合計_計     全国 2011   人  9834031</code></pre>
</div>
</div>
<p>全国のみのデータなので，「value」列はすべて数値かもしれない。 試しに変換してみる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.double</span>(df3<span class="sc">$</span>value)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 10444426 10370172 10267614 10145363  9977967  9834031  9693855  9579441
  [9]  9494334  9432809  9322431  9188153  9145856  9100072  9071894  9082535
 [17]  9108596  9125267  9128476 10346202 10272942 10171350 10049996  9883694
 [25]  9740311  9600185  9488013  9401968  9343691  9234138  9101310  9059342
 [33]  9013949  8986018  8997213  9024008  9041646  9044906    98224    97230
 [41]    96264    95367    94273    93720    93670    91428    92366    89118
 [49]    88293    86843    86514    86123    85876    85322    84588    83621
 [57]    83570  4367858  4433389  4495106  4561504  4614306  4668961  4720274
 [65]  4775204  4828192  4888449  4942200  4997797  5054943  5107942  5158762
 [73]  5211211  5249499  5296252  5344203  4348560  4415549  4478620  4546050
 [81]  4599727  4655215  4707348  4762961  4816570  4877364  4931853  4988029
 [89]  5045472  5098862  5149940  5202171  5240785  5287799  5335636   939283
 [97]   937145   932121   928584   917488   907486   890718   881294   872402
[105]   853238   812508   804583   786357   787965   783806   769748   746719
[113]   739550   734003      813      838      945     1056     1297    19298
[121]    17840    16486    15454    14579    13746     6234     5656     5035
[129]     4729     4413     4308    13064    12184    11451    10725    10166
[137]     9438    12926    12243    11622    11085    10347     9768     9471
[145]     9080     8822     9040     8714     8453     8567     4172     4027
[153]     3976     3955     3892     3272     3108     3071       48       28
[161]       56       43       60       36       54       75  3707401  3770762
[169]  3818148  3896532  3939700  4007419  4068269  4127031  4184898  4242450
[177]  4294622  4349898  4397013  4444800  4495922  4540713  4573809  4615721
[185]  4651702  6076568  5936783  5772508  5583859  5363661  5165070  4973581
[193]  4804237  4666142  4544360  4380231  4190356  4090913  3992130  3913132
[201]  3871324  3859097  3829015  3784273  5997642  5857393  5692730  5503946
[209]  5283967  5085096  4892837  4725052  4585398  4466327  4302285  4113281
[217]  4013870  3915087  3836078  3795042  3783223  3753847  3709270    78926
[225]    79390    79778    79913    79694    79974    80744    79185    80744
[233]    78033    77946    77075    77043    77043    77054    76282    75874
[241]    75168    75003      197      258      218      223      252      236
[249]     2839     2476     2564     2617     2812     2945     3898     4148
[257]     3842     5244    75892    76656    76996    77073    76617    76793
[265]    15532    13665    12216    12118      379      441      404      409
[273]      476      570      667      506  4901662  4813905  4685872  4556467
[281]  4354676  4195486  4060925  3931565  3824465  3719601  3603866  3443602
[289]  3349944  3270872  3193309  3168465  3163107  3141118  3101037      633
[297]      653      657      677      679      691      694      706      727
[305]      770      799      840      860      891      966     1082     1274
[313]     1446     1620</code></pre>
</div>
</div>
<p>エラーや警告が出ないため，次に進んで問題ない。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df3<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.double</span>(df3<span class="sc">$</span>value)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>いよいよ”組合員別内訳”に何が入っているか確認する。 こういう予想できないものは，データフレームをある程度整理してからの方が理解しやすいであろう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df3[, <span class="st">"組合員別内訳"</span>])</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "合計_計"                                 
 [2] "合計_個人"                               
 [3] "合計_団体"                               
 [4] "正組合員_計"                             
 [5] "正組合員_個人"                           
 [6] "正組合員_個人_女性"                      
 [7] "正組合員_個人_組合員たる地位を失わない者"
 [8] "正組合員_法人"                           
 [9] "正組合員_法人_農事組合法人"              
[10] "正組合員_法人_その他法人"                
[11] "正組合員_団体"                           
[12] "正組合員_団体_農事組合法人"              
[13] "正組合員_団体_株式会社"                  
[14] "正組合員_団体_合名会社"                  
[15] "正組合員_団体_合資会社"                  
[16] "正組合員戸数"                            
[17] "准組合員_計"                             
[18] "准組合員_個人"                           
[19] "准組合員_団体"                           
[20] "准組合員_団体_農業協同組合"              
[21] "准組合員_団体_農事組合法人"              
[22] "准組合員_団体_その他団体"                
[23] "准組合員_団体_株式会社"                  
[24] "准組合員_団体_合名会社"                  
[25] "准組合員_団体_合資会社"                  
[26] "准組合員戸数"                            
[27] "一戸複数正組合員制実施組合数"            </code></pre>
</div>
</div>
<p>ここで，正組合員と准組合員の内訳のデータがあることが分かる。 念のため，ここで「unit」列との対応を確認しておく。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">apply</span>(df3[, <span class="fu">c</span>(<span class="st">"組合員別内訳"</span>, <span class="st">"unit"</span>)], <span class="dv">1</span>, paste, <span class="at">collapse =</span> <span class="st">" "</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
          一戸複数正組合員制実施組合数 組合 
                                         19 
                                 合計_計 人 
                                         19 
                               合計_個人 人 
                                         19 
                               合計_団体 人 
                                         19 
                             准組合員_計 人 
                                         19 
                           准組合員_個人 人 
                                         19 
                           准組合員_団体 人 
                                         19 
                准組合員_団体_その他団体 人 
                                          6 
                  准組合員_団体_株式会社 人 
                                          4 
                  准組合員_団体_合資会社 人 
                                          4 
                  准組合員_団体_合名会社 人 
                                          4 
              准組合員_団体_農業協同組合 人 
                                          6 
              准組合員_団体_農事組合法人 人 
                                         10 
                            准組合員戸数 戸 
                                         19 
                             正組合員_計 人 
                                         19 
                           正組合員_個人 人 
                                         19 
                      正組合員_個人_女性 人 
                                         19 
正組合員_個人_組合員たる地位を失わない者 人 
                                          5 
                           正組合員_団体 人 
                                         13 
                  正組合員_団体_株式会社 人 
                                          4 
                  正組合員_団体_合資会社 人 
                                          4 
                  正組合員_団体_合名会社 人 
                                          4 
              正組合員_団体_農事組合法人 人 
                                          4 
                           正組合員_法人 人 
                                          6 
                正組合員_法人_その他法人 人 
                                          6 
              正組合員_法人_農事組合法人 人 
                                          6 
                            正組合員戸数 戸 
                                         19 </code></pre>
</div>
</div>
<p>法人も単位は「人」になっている。 「組合」と「戸」だけ注意が必要である。</p>
<p>ここで，見栄えのためだけに，アンダーバーを括弧に変換しておく。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _を（）に変換する（factorではない場合）</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df3[, <span class="st">"組合員別内訳"</span>] <span class="ot">&lt;-</span> <span class="fu">apply</span>(df3[, <span class="st">"組合員別内訳"</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) {</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">grep</span>(<span class="st">"_"</span>, x)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"_"</span>, <span class="st">"（"</span>, x), <span class="st">"）"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)}</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># _を2つ使っているケースに対応</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>df3[, <span class="st">"組合員別内訳"</span>] <span class="ot">&lt;-</span> <span class="fu">apply</span>(df3[, <span class="st">"組合員別内訳"</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) {</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">grep</span>(<span class="st">"_"</span>, x)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"_"</span>, <span class="st">"（"</span>, x), <span class="st">"）"</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)}</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df3[, <span class="st">"組合員別内訳"</span>])</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "合計（計）"                                    
 [2] "合計（個人）"                                  
 [3] "合計（団体）"                                  
 [4] "正組合員（計）"                                
 [5] "正組合員（個人）"                              
 [6] "正組合員（個人（女性））"                      
 [7] "正組合員（個人（組合員たる地位を失わない者））"
 [8] "正組合員（法人）"                              
 [9] "正組合員（法人（農事組合法人））"              
[10] "正組合員（法人（その他法人））"                
[11] "正組合員（団体）"                              
[12] "正組合員（団体（農事組合法人））"              
[13] "正組合員（団体（株式会社））"                  
[14] "正組合員（団体（合名会社））"                  
[15] "正組合員（団体（合資会社））"                  
[16] "正組合員戸数"                                  
[17] "准組合員（計）"                                
[18] "准組合員（個人）"                              
[19] "准組合員（団体）"                              
[20] "准組合員（団体（農業協同組合））"              
[21] "准組合員（団体（農事組合法人））"              
[22] "准組合員（団体（その他団体））"                
[23] "准組合員（団体（株式会社））"                  
[24] "准組合員（団体（合名会社））"                  
[25] "准組合員（団体（合資会社））"                  
[26] "准組合員戸数"                                  
[27] "一戸複数正組合員制実施組合数"                  </code></pre>
</div>
</div>
</section>
<section id="データ整形-1" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="データ整形-1"><span class="header-section-number">3</span> データ整形</h2>
<p>作図のためには，ここまでで整形されたデータフレームから，作図に必要な行を抽出すればよい。 まず，正組合員と准組合員の折れ線グラフを描くことにしよう。 その前に，これまでデータフレームに番号を振っており，どれが最新か分かりづらいため，最新のデータフレームを分かりやすいデータフレーム名に変更しておく。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dfja <span class="ot">&lt;-</span> df3</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsci)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>dfja1 <span class="ot">&lt;-</span> dfja[<span class="fu">grep</span>(<span class="st">"^正組合員（計）$|^准組合員（計）$"</span>, dfja[, <span class="st">"組合員別内訳"</span>]), ]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>dfja1[, <span class="st">"組合員別内訳"</span>] <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfja1[, <span class="st">"組合員別内訳"</span>], <span class="at">levels =</span> <span class="fu">unique</span>(dfja1[, <span class="st">"組合員別内訳"</span>]))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dfja1) <span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6000000</span>, <span class="dv">1000000</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">name =</span> <span class="st">"組合員数"</span>) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"農業協同組合の組合員数の推移"</span>) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"出所：農林水産省『農業協同組合及び同連合会一斉調査 確報 総合農協統計表』</span><span class="sc">\n</span><span class="st">（https://www.e-stat.go.jp/dbview?sid=0003406360）"</span>) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_d3</span>()</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"HiraKakuProN-W3"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08_data_formatting_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>正組合員が准組合員が逆転する折れ線グラフが描けた。</p>
<p>次に，個人以外の組合員についても見ていこう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>dfja2 <span class="ot">&lt;-</span> dfja[<span class="fu">grep</span>(<span class="st">"^正組合員（個人）$|^正組合員（法人）$|^正組合員（団体）$|^准組合員（個人）$|^准組合員（団体）$"</span>, dfja[, <span class="st">"組合員別内訳"</span>]), ]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dfja2[, <span class="st">"組合員別内訳"</span>] <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfja2[, <span class="st">"組合員別内訳"</span>], <span class="at">levels =</span> <span class="fu">unique</span>(dfja2[, <span class="st">"組合員別内訳"</span>]))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dfja2) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">name =</span> <span class="st">"組合員数"</span>) <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"農業協同組合の組合員数（個人，法人，団体）の推移"</span>) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"出所：農林水産省『農業協同組合及び同連合会一斉調査 確報 総合農協統計表』</span><span class="sc">\n</span><span class="st">（https://www.e-stat.go.jp/dbview?sid=0003406360）"</span>) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_d3</span>()</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"HiraKakuProN-W3"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08_data_formatting_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(g, <span class="at">file =</span> <span class="fu">file.path</span>(outdir, <span class="st">"number_of_ja_members_kojin_dantai.pdf"</span>), <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">4</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>正組合員（団体）のグラフが途中で消え，正組合員（法人）のグラフが途中から現れていることが気になる。 正組合員（団体）の値と正組合員（法人）の値が近いことから，統計の取り方が変わった可能性が考えられる。 元のデータで，正組合員（団体）が途中から欠損値になっているかどうかを確認してみる。 表を見る場合は，データをロングではなくワイドにした方が分かりやすい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">dcast</span>(dfja2, 年度 <span class="sc">~</span> 組合員別内訳)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>caption <span class="ot">&lt;-</span> <span class="st">"農業協同組合の組合員数（個人，法人，団体）の推移"</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  tmp, <span class="at">caption =</span> caption, <span class="at">rownames =</span> <span class="cn">TRUE</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">extensions =</span> <span class="fu">c</span>(<span class="st">'Buttons'</span>, <span class="st">'ColReorder'</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">20</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'Blfrtip'</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">'csv'</span>, <span class="st">'excel'</span>),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">I</span>(<span class="st">'colvis'</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">colReorder =</span> <span class="cn">TRUE</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">formatCurrency</span>(<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(tmp)), <span class="at">currency =</span> <span class="st">""</span>, <span class="at">interval =</span> <span class="dv">3</span>, <span class="at">mark =</span> <span class="st">","</span>, <span class="at">digits =</span> <span class="dv">0</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6bbcb4365dad660f363a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6bbcb4365dad660f363a">{"x":{"filter":"none","vertical":false,"extensions":["Buttons","ColReorder"],"caption":"<caption>農業協同組合の組合員数（個人，法人，団体）の推移<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],[1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016],[5335636,5287799,5240785,5202171,5149940,5098862,5045472,4988029,4931853,4877364,4816570,4762961,4707348,4655215,4599727,4546050,4478620,4415549,4348560],[null,null,null,null,null,null,null,null,null,null,null,null,null,13746,14579,15454,16486,17840,19298],[8567,8453,8714,9040,8822,9080,9471,9768,10347,11085,11622,12243,12926,null,null,null,null,null,null],[3709270,3753847,3783223,3795042,3836078,3915087,4013870,4113281,4302285,4466327,4585398,4725052,4892837,5085096,5283967,5503946,5692730,5857393,5997642],[75003,75168,75874,76282,77054,77043,77043,77075,77946,78033,80744,79185,80744,79974,79694,79913,79778,79390,78926]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>年度<\/th>\n      <th>正組合員（個人）<\/th>\n      <th>正組合員（法人）<\/th>\n      <th>正組合員（団体）<\/th>\n      <th>准組合員（個人）<\/th>\n      <th>准組合員（団体）<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"dom":"Blfrtip","buttons":[["csv","excel"],["colvis"]],"colReorder":true,"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render","options.columnDefs.4.render"],"jsHooks":[]}</script>
</div>
</div>
<p>予想どおりのデータである。</p>
<p>次に，授業では女性の組合員が増えていることを説明した。 このことを実際のデータで確認してみよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dfja3 <span class="ot">&lt;-</span> dfja[<span class="fu">grep</span>(<span class="st">"^正組合員（個人（女性））$"</span>, dfja[, <span class="st">"組合員別内訳"</span>]), ]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>dfja3[, <span class="st">"組合員別内訳"</span>] <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfja3[, <span class="st">"組合員別内訳"</span>], <span class="at">levels =</span> <span class="fu">unique</span>(dfja3[, <span class="st">"組合員別内訳"</span>]))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dfja3) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">name =</span> <span class="st">"組合員数"</span>) <span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"農業協同組合の組合員数（女性）の推移"</span>) <span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"出所：農林水産省『農業協同組合及び同連合会一斉調査 確報 総合農協統計表』</span><span class="sc">\n</span><span class="st">（https://www.e-stat.go.jp/dbview?sid=0003406360）"</span>) <span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_d3</span>()</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"HiraKakuProN-W3"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08_data_formatting_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(g, <span class="at">file =</span> <span class="fu">file.path</span>(outdir, <span class="st">"number_of_ja_members_female.pdf"</span>), <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">4</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>確かに女性の組合員は増加していることが分かる。 ただし，これだと組合員全体に占める女性の比率が分からないので，上述のグラフと重ねてもよいだろう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dfja4 <span class="ot">&lt;-</span> dfja[<span class="fu">grep</span>(<span class="st">"^正組合員（個人（女性））$|^正組合員（計）$|^准組合員（計）$"</span>, dfja[, <span class="st">"組合員別内訳"</span>]), ]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>dfja4[, <span class="st">"組合員別内訳"</span>] <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfja4[, <span class="st">"組合員別内訳"</span>], <span class="at">levels =</span> <span class="fu">unique</span>(dfja4[, <span class="st">"組合員別内訳"</span>]))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dfja4) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6000000</span>, <span class="dv">1000000</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">name =</span> <span class="st">"組合員数"</span>) <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"農業協同組合の組合員数の推移"</span>) <span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"出所：農林水産省『農業協同組合及び同連合会一斉調査 確報 総合農協統計表』</span><span class="sc">\n</span><span class="st">（https://www.e-stat.go.jp/dbview?sid=0003406360）"</span>) <span class="sc">+</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_d3</span>()</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"HiraKakuProN-W3"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08_data_formatting_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(g, <span class="at">file =</span> <span class="fu">file.path</span>(outdir, <span class="st">"number_of_ja_members_female_vs_all.pdf"</span>), <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">4</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>組合員戸数の推移はどうだろうか。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dfja5 <span class="ot">&lt;-</span> dfja[<span class="fu">grep</span>(<span class="st">"^正組合員戸数$|^准組合員戸数$"</span>, dfja[, <span class="st">"組合員別内訳"</span>]), ]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>dfja5[, <span class="st">"組合員別内訳"</span>] <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfja5[, <span class="st">"組合員別内訳"</span>], <span class="at">levels =</span> <span class="fu">unique</span>(dfja5[, <span class="st">"組合員別内訳"</span>]))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dfja5) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">name =</span> <span class="st">"組合員戸数"</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"農業協同組合の組合員戸数の推移"</span>) <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"出所：農林水産省『農業協同組合及び同連合会一斉調査 確報 総合農協統計表』</span><span class="sc">\n</span><span class="st">（https://www.e-stat.go.jp/dbview?sid=0003406360）"</span>) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_d3</span>()</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"HiraKakuProN-W3"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08_data_formatting_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(g, <span class="at">file =</span> <span class="fu">file.path</span>(outdir, <span class="st">"number_of_ja_members_hh.pdf"</span>), <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">4</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ここで扱っているのデータには，“一戸複数正組合員制実施組合数”の値も含まれている。 授業を踏まえると，この組合数は減少している可能性が考えられる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dfja6 <span class="ot">&lt;-</span> dfja[<span class="fu">grep</span>(<span class="st">"^一戸複数正組合員制実施組合数$"</span>, dfja[, <span class="st">"組合員別内訳"</span>]), ]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>dfja6[, <span class="st">"組合員別内訳"</span>] <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfja6[, <span class="st">"組合員別内訳"</span>], <span class="at">levels =</span> <span class="fu">unique</span>(dfja6[, <span class="st">"組合員別内訳"</span>]))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dfja6) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> 年度, <span class="at">y =</span> value, <span class="at">group =</span> 組合員別内訳, <span class="at">colour =</span> 組合員別内訳)) <span class="sc">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">name =</span> <span class="st">"組合数"</span>) <span class="sc">+</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"一戸複数正組合員制実施組合数の推移"</span>) <span class="sc">+</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"出所：農林水産省『農業協同組合及び同連合会一斉調査 確報 総合農協統計表』</span><span class="sc">\n</span><span class="st">（https://www.e-stat.go.jp/dbview?sid=0003406360）"</span>) <span class="sc">+</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_d3</span>()</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"HiraKakuProN-W3"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08_data_formatting_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(g, <span class="at">file =</span> <span class="fu">file.path</span>(outdir, <span class="st">"number_of_ja_members_female_vs_all.pdf"</span>), <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">4</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>実際にグラフを作成すると，一戸複数正組合員制実施組合数の現象が確認できる。 ただし，農業協同組合の数が減少しているため，この数値の動きだけでは多くを語ることはできない。</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "コピーしました");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "コピーしました");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>